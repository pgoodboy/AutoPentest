from subprocess import PIPE, run
import tldextract
import os
import time
#extract domain name
#addr = input("Enter Web App URL : ")
#addr = tldextract.extract(addr)
#addr = "{}.{}".format(addr.domain,addr.suffix)
#print(addr)
#Run kinux command function
def out(command):
    result = run(command, stdout=PIPE, stderr=PIPE, universal_newlines=True, shell=True)
    return result.stdout
#dnsmap
#out("dnsmap "+addr+" | grep "+addr+" > dns.txt")
#lines_seen = set()
#rm duplicated lines
#outfile = open("dnsNoDup.txt", "w")
#for line in open("dns.txt", "r"):
#    if line not in lines_seen:
#        outfile.write(line)
#        lines_seen.add(line)
#outfile.close()

#Loop enum4linux
#outfile=open("smb.txt", "w")
#for line in open("dnsNoDup.txt", "r"):
#    m = out("enum4linux -a "+line)
#    outfile.write(m)
#outfile.close()

#nmap
fullPort = out("nmap -A -sV -iL dnsNoDup.txt -oG output.grep") #removed -p- arg for faster testing
if os.path.exists("portList.txt"):
  os.remove("portList.txt")
a= out('./porttest.sh')
count = 0
ip = ""
webaddr = ""
for line in open("portList.txt", "r"):
    if line != "END\n":
        if count == 0 :
            ip = line.rstrip()
            count = count+1
        else:
            add = ip+":"+line
            webaddr = webaddr+ add
    else:
        count = 0
outfile = open("portList.txt", "w")
outfile.write(webaddr)
outfile.close()
#Loop dirb
outfile = open("direct.txt", "w")
for line in open("portList.txt", "r"):
    m = out("dirb http://"+line)
    outfile.write(m)
outfile.close()